{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["// 重写数组中的部分方法\n\nlet oldArrayProto = Array.prototype // 获取数组的原型\n\n// newArrayProto.__proto__ = oldArrayProto\nexport let newArrayProto = Object.create(oldArrayProto)\n\n// 找到所有的变异方法（会改变原数组）\nlet methods = ['push', 'pop', 'shift', 'unshift', 'reverse', 'sort', 'splice']\n\nmethods.forEach((method) => {\n    // 这里重写了数组的方法\n    newArrayProto[method] = function (...args) {\n        const result = oldArrayProto[method].call(this, ...args) // 内部调用原来的方法，函数的劫持，切片编程\n\n        // 需要对数据新增的数据再次进行劫持\n        let inserted\n        let ob = this.__ob__\n        switch (method) {\n            case 'push':\n            case 'unshift':\n                inserted = args\n                break\n            case 'splice':\n                inserted = args.slice(2)\n            default:\n                break\n        }\n        // console.log('ob', this) // 新增的内容\n        if (inserted) {\n            // 对新增的内容再次进行观测\n            ob.observeArray(inserted)\n        }\n\n        return result\n    }\n})\n","import { newArrayProto } from './array'\n\nclass Observer {\n    constructor(data) {\n        // Object.defineProperty 只能劫持已存在的属性（vue里面会为此单独写一些api  $set $delete）\n        Object.defineProperty(data, '__ob__', {\n            value: this,\n            enumerable: false // 将__ob__变成不可枚举（循环的时候无法获取）\n        })\n\n        // console.log('Observer', data)\n        // data.__ob__ = this // 给数组加了一个标识，如果数据上有__ob__则说明这个属性被观测过了\n        if (Array.isArray(data)) {\n            // 重写数组的方法\n\n            data.__proto__ = newArrayProto // 需要保留数组原有的特性，并且可以重写部分方法\n            this.observeArray(data) //如果数组中的元素是对象，可以监控到对象的变化\n        } else {\n            this.walk(data)\n        }\n    }\n    // 循环对象，对属性依次劫持\n    walk(data) {\n        // “重新定义”属性，性能差\n        Object.keys(data).forEach((key) => defineReactive(data, key, data[key]))\n    }\n    // 观测数组\n    observeArray(data) {\n        data.forEach((item) => observe(item))\n    }\n}\n\n// 属性劫持(闭包)\nexport function defineReactive(target, key, value) {\n    observe(value) // 深度劫持，对所有对象都进行属性劫持\n    Object.defineProperty(target, key, {\n        // 取值的时候，会执行get\n        get() {\n            console.log('get', key, value)\n            return value\n        },\n        // 修改的时候，会执行set\n        set(newValue) {\n            if (newValue === value) return // 如果修改的值和原来的值相同，直接返回\n            observe(newValue) // 如果修改的值是一个对象，对这个对象进行劫持\n            value = newValue\n        }\n    })\n}\n\n// 观测（劫持）data对象\nexport function observe(data) {\n    // 只对对象进行劫持\n    if (typeof data !== 'object' || data == null) {\n        return\n    }\n\n    // 这个对象已经被代理过\n    if (data.__ob__ instanceof Observer) {\n        return\n    }\n\n    // 如果一个对象被劫持过了，那就不需要再被劫持了（要判断一个对象是否被劫持过，可以添加一个实例，用实例来判断是够被劫持过）\n    return new Observer(data)\n}\n","import { observe } from './observe/index'\n\nexport function initState(vm) {\n    const opts = vm.$options // 获取所有的选项\n    if (opts.data) {\n        initData(vm) // 初始化数据\n    }\n}\n\nfunction proxy(vm, target, key) {\n    // vm.name --> vm._data.name\n    Object.defineProperty(vm, key, {\n        get() {\n            return vm[target][key]\n        },\n        set(newValue) {\n            vm[target][key] = newValue\n        }\n    })\n}\n\nfunction initData(vm) {\n    let data = vm.$options.data // data 可能是函数和对象\n    data = typeof data === 'function' ? data.call(this) : data\n\n    vm._data = data // 把数据添加到实例的_data上\n    // 对数据进行劫持 vue2里采用了一个API：Object.defineProperty\n    observe(data)\n\n    // 将vm._data 用vm来代理\n    for (let key in data) {\n        proxy(vm, '_data', key)\n    }\n}\n","import { initState } from './state'\n\n// 用来给Vue增加init方法\nexport function initMixin(Vue) {\n    // 用于初始化操作\n    Vue.prototype._init = function (options) {\n        // vue vm.$options 就是获取用户的配置\n\n        // 我们使用vue的时候，以$开头的（$nextTick, $data, $attr）是vue内置属性\n        const vm = this\n        vm.$options = options // 将用户的选项挂载到实例上\n\n        // 初始化状态\n        initState(vm)\n    }\n}\n","import { initMixin } from './init'\n\n// options是用户的选项\nfunction Vue(options) {\n    this._init(options) // 默认调用init\n}\n\ninitMixin(Vue) // 扩展了init方法\n\nexport default Vue\n"],"names":["oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","method","_oldArrayProto$method","_len","arguments","length","args","_key","result","call","apply","concat","inserted","ob","__ob__","slice","observeArray","Observer","data","_classCallCheck","defineProperty","value","enumerable","isArray","__proto__","walk","_createClass","key","keys","defineReactive","item","observe","target","get","console","log","set","newValue","_typeof","initState","vm","opts","$options","initData","proxy","_data","initMixin","Vue","_init","options"],"mappings":"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"}